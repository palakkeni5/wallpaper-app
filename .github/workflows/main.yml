name: Android Build

on:
  push:
    branches: ['main', 'feature/github-actions-builds']

jobs:
  android-build:
    name: Android Build
    runs-on: self-hosted
    steps:
      - name: Show self-hosted machine infomation
        run: uname -a
      - name: Cancel previous runs
        uses: styfle/cancel-workflow-action@0.9.1
      - name: Check out Git repository
        uses: actions/checkout@v2
      - name: Install dependencies
        run: yarn install
      - name: Make Gradlew Executable
        run: cd android && chmod +x ./gradlew
      - name: Build Android Release
        run: |
          cd android && ./gradlew clean && ./gradlew app:assembleRelease
      - name: Sign APK
        id: sign_app
        uses: r0adkll/sign-android-release@v1
        with:
          releaseDirectory: ${{ github.workspace}}/app-name/android/app/build/outputs/apk/release
          # signingKeyBase64: ${{ secrets.ANDROID_SIGNING_KEY }}
          # alias: ${{ secrets.ANDROID_SIGNING_ALIAS }}
          # keyStorePassword: ${{ secrets.MYAPP_UPLOAD_STORE_PASSWORD }}
          # keyPassword: ${{ secrets.MYAPP_UPLOAD_KEY_PASSWORD }}
      - name: Upload APK
        id: uploadArtifact
        uses: actions/upload-artifact@v2
        with:
          name: app
          path: ${{steps.sign_app.outputs.signedReleaseFile}}
